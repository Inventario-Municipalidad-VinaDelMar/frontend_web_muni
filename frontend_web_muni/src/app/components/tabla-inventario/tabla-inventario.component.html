<div class="table-container">
  <!-- Carga inicial con spinner y mensaje -->
  <div *ngIf="isLoading" class="loading-container">
    <p> Cargando datos... Por favor, espere. </p>
  </div>

  <!-- Mensaje de error cuando no hay respuesta del servicio -->
  <div *ngIf="hasError" class="error-container">
    <h3>Error de Carga</h3>
    <img src="assets/img/no-producto.jpeg" alt="No hay productos" class="no-productos-image" />
    <h6>El servicio no est치 disponible en este momento. Intente m치s tarde.</h6>
  </div>

  <!-- Tabla de datos cuando se ha completado la carga sin errores -->
  <div *ngIf="!isLoading && !hasError">
    <table class="custom-table">
      <!-- Encabezado de la tabla -->
      <thead>
        <tr>
          <th>Nombre del Producto</th>
          <th>Cantidad Total</th>
          <th>Productos por Vencer</th>
          <th>Fecha de Vencimiento Pr칩xima</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <!-- Cuerpo de la tabla -->
      <tbody>
        <!-- Bucle principal para cada producto, incluyendo la fila expandible -->
        <ng-container *ngFor="let producto of productos2">
          <!-- Fila principal del producto -->
          <tr>
            <td>{{ producto.nombre }}</td>
            <td>{{ calcularCantidadTotal(producto) }}</td>
            <td>{{ calcularCantidadPorVencer(producto) }}</td>
            <td>{{ calcularFechaProxima(producto) }}</td>
            <td>
              <button 
                class="boton-expandir" 
                (click)="toggleExpansion(producto.id)">
                {{ expandedRows[producto.id] ? 'Minimizar' : 'Expandir' }}
              </button>
            </td>
          </tr>

          <!-- Fila expandible para mostrar detalles de las tandas si est치 expandido -->
          <tr *ngIf="expandedRows[producto.id]" class="expanded-row">
            <td colspan="5">
              <table class="expanded-content">
                <thead>
                  <tr>
                    <th>Tanda</th>
                    <th>Cantidad Actual</th>
                    <th>Fecha de Vencimiento</th>
                    <th>Fecha de Ingreso</th>
                    <th>Ubicacion</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let tanda of producto.tandas?.slice(0, 10)" [ngClass]="calcularEstadoVencimiento(tanda)">
                    <td>{{ tanda.producto }}</td>
                    <td>{{ tanda.cantidadActual }}</td>
                    <td>{{ tanda.fechaVencimiento | date: 'yyyy-MM-dd' }}</td>
                    <td>{{ tanda.fechaLlegada | date: 'yyyy-MM-dd' }}</td>
                    <td>{{ tanda.ubicacion }}</td>
                    <td>{{ tanda.bodega }}</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </ng-container>
      </tbody>

      <!-- Pie de la tabla -->
      <tfoot>
        <tr>
          <td colspan="5">Total Productos: {{ productos2.length }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
