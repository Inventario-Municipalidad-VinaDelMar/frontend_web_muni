<div class="">
    <!-- Removemos el spinner de carga -->
    <p-table 
      [value]="categorias2" 
      [tableStyle]="{ 'min-width': '70rem' }" 
      dataKey="id" 
      [resizableColumns]="true" 
      [expandedRowKeys]="expandedRows" 
      [paginator]="true" 
      [rows]="10"
      styleClass="custom-table p-datatable-gridlines">

      <!-- Encabezado de la tabla -->
      <ng-template pTemplate="header">
        <tr>
          <th pResizableColumn class="th">Nombre de la Categoría</th>
          <th pResizableColumn class="th">Cantidad Total</th>
          <th pResizableColumn class="th">Productos por Vencer</th>
          <th pResizableColumn class="th">Acciones</th>
        </tr>
      </ng-template>

      <!-- Cuerpo de la tabla con efecto de carga en las celdas -->
      <ng-template pTemplate="body" let-categoria>
        <tr class="tr">
          <td class="td" [ngClass]="{'loading-placeholder': isLoading, 'table-cell': !isLoading}">
            {{ isLoading ? '' : categoria.nombre }}
          </td>
          <td class="td highlight-number" [ngClass]="{'loading-placeholder': isLoading, 'table-cell': !isLoading}">
            {{ isLoading ? '' : calcularCantidadTotal(categoria) }}
          </td>
          <td class="td highlight-number" [ngClass]="{'loading-placeholder': isLoading, 'table-cell': !isLoading}">
            {{ isLoading ? '' : calcularCantidadPorVencer(categoria) }}
          </td>
          <td class="td" [ngClass]="{'loading-placeholder': isLoading, 'table-cell': !isLoading}">
            <button *ngIf="!isLoading" pButton label="Expandir" class="botones-expandir" icon="pi pi-plus" (click)="expandedRows[categoria.id] = !expandedRows[categoria.id]"></button>
          </td>
        </tr>

        <!-- Fila expandida que muestra detalles de las tandas (sin efecto de carga) -->
        <tr *ngIf="expandedRows[categoria.id]" class="expanded-row">
          <td colspan="5" class="expanded-body">
            <div class="expanded-content">
              <p-table [value]="categoria.tandas" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-gridlines">
                <ng-template pTemplate="header">
                  <tr>
                    <th class="th">Producto</th>
                    <th class="th">Cantidad Actual</th>
                    <th class="th">Fecha de Vencimiento</th>
                    <th class="th">Fecha de ingreso</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-tanda>
                  <tr>
                    <td class="td">{{ tanda.producto }}</td>
                    <td class="td">{{ tanda.cantidadActual }}</td>
                    <td class="td">{{ tanda.fechaVencimiento | date: 'yyyy-MM-dd' }}</td>
                    <td class="td">{{ tanda.fechaLlegada | date: 'yyyy-MM-dd' }}</td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Pie de la tabla -->
      <ng-template pTemplate="footer">
        <tr>
          <td colspan="5">
            Total Categorías: {{ categorias2.length }}
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
