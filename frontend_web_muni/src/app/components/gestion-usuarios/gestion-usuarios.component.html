<div class="gestion-usuarios-container">
  <p-card>
    <div class="header">
      <h2>Gestión de Usuarios</h2>
      <p-button label="Agregar Usuario" icon="pi pi-plus" (click)="abrirDialogoAgregar()" class="btn-agregar-usuario"></p-button>
    </div>

    <p-divider></p-divider>

    <!-- Tabla de usuarios -->
    <div class="usuarios-tabla">
      <p-panel header="Listado de Usuarios" class="tabla-panel">
        <p-table [value]="usuarios" selectionMode="single" [(selection)]="usuarioSeleccionado" (onRowSelect)="mostrarDetalles()" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>ID</th>
              <th>RUT</th>
              <th>Nombre Completo</th>
              <th>Email</th>
              <th>Roles</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-usuario>
            <tr>
              <td>{{ usuario.id }}</td>
              <td>{{ usuario.rut }}</td>
              <td>{{ usuario.nombre }} {{ usuario.apellidoPaterno }} {{ usuario.apellidoMaterno }}</td>
              <td>{{ usuario.email }}</td>
              <td>{{ usuario.roles.join(', ') }}</td>
            </tr>
          </ng-template>
        </p-table>
      </p-panel>
    </div>

    <!-- Panel de detalles del usuario seleccionado -->
    <div *ngIf="usuarioSeleccionado" class="detalles-usuario">
      <p-card header="Detalles del Usuario Seleccionado">
        <div class="detalles-contenido">
          <p><strong>ID:</strong> {{ usuarioSeleccionado.id }}</p>
          <p><strong>RUT:</strong> {{ usuarioSeleccionado.rut }}</p>
          <p><strong>Nombre:</strong> {{ usuarioSeleccionado.nombre }} {{ usuarioSeleccionado.apellidoPaterno }} {{ usuarioSeleccionado.apellidoMaterno }}</p>
          <p><strong>Email:</strong> {{ usuarioSeleccionado.email }}</p>
          <p><strong>Roles:</strong> {{ usuarioSeleccionado.roles.join(', ') }}</p>
        </div>
        <p-footer>
          <p-button label="Editar" icon="pi pi-pencil" (click)="abrirDialogoEditar(usuarioSeleccionado)" class="p-button-warning"></p-button>
        </p-footer>
      </p-card>
    </div>
  </p-card>

  <!-- Diálogo para agregar usuario -->
  <p-dialog header="Agregar Usuario" [(visible)]="mostrarDialogoAgregar" [modal]="true" [style]="{ width: '400px' }" (onHide)="cerrarDialogoAgregar()">
    <div class="p-fluid">
      <div class="field">
        <label for="nombre">Nombre</label>
        <input id="nombre" [(ngModel)]="nuevoUsuario.nombre" type="text" pInputText />
      </div>

      <div class="field">
        <label for="apellidoPaterno">Apellido Paterno</label>
        <input id="apellidoPaterno" [(ngModel)]="nuevoUsuario.apellidoPaterno" type="text" pInputText />
      </div>

      <div class="field">
        <label for="apellidoMaterno">Apellido Materno</label>
        <input id="apellidoMaterno" [(ngModel)]="nuevoUsuario.apellidoMaterno" type="text" pInputText />
      </div>

      <div class="field">
        <label for="email">Email</label>
        <input id="email" [(ngModel)]="nuevoUsuario.email" type="email" pInputText />
      </div>

      <div class="field">
        <label for="roles">Roles</label>
        <input id="roles" [(ngModel)]="nuevoUsuario.roles" type="text" pInputText placeholder="Ejemplo: administrador, usuario" />
      </div>

      <p-footer>
        <div class="dialog-footer">
          <p-button label="Guardar" icon="pi pi-check" (click)="guardarUsuario()" class="p-button-success"></p-button>
          <p-button label="Cancelar" icon="pi pi-times" (click)="cerrarDialogoAgregar()" class="p-button-secondary"></p-button>
        </div>
      </p-footer>
    </div>
  </p-dialog>
</div>
