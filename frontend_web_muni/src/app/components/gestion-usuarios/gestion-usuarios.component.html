<div class="gestion-usuarios-container">
  <div class="overlay" *ngIf="mostrarDialogoAgregar || mostrarDialogoDetalles"></div>

  <!-- Encabezado con bot칩n de agregar usuario -->
  <div class="header">
    <h2 class="header-title">Gesti칩n de Usuarios</h2>
    <button class="btn-link" (click)="abrirDialogoAgregar()">+ Agregar Usuario</button>
  </div>

  <!-- Tarjeta con la tabla de usuarios -->
  <div class="usuarios-list-card">
    <h3>Listado de Usuarios</h3>
    <table class="usuarios-table" *ngIf="usuarios.length > 0; else noUsuarios">
      <thead>
        <tr>
          <th>ID</th>
          <th>RUT</th>
          <th>Nombre Completo</th>
          <th>Email</th>
          <th>Roles</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuarios" (click)="seleccionarUsuario(usuario)" class="table-row">
          <td>{{ usuario.id }}</td>
          <td>{{ usuario.rut }}</td>
          <td>{{ usuario.nombre }} {{ usuario.apellidoPaterno }} {{ usuario.apellidoMaterno }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.roles.join(', ') }}</td>
        </tr>
      </tbody>
    </table>
    <ng-template #noUsuarios>
      <p class="no-usuarios">No hay usuarios registrados.</p>
    </ng-template>
  </div>

  <!-- Di치logo de detalles del usuario -->
  <div class="custom-dialog" *ngIf="mostrarDialogoDetalles">
    <div class="custom-dialog-content">
      <h3>Detalles del Usuario</h3>
      <div class="detalles-contenido centrado">
        <p><strong>ID:</strong> {{ usuarioSeleccionado?.id }}</p>
        <p><strong>RUT:</strong> {{ usuarioSeleccionado?.rut }}</p>
        <p><strong>Nombre:</strong> {{ usuarioSeleccionado?.nombre }} {{ usuarioSeleccionado?.apellidoPaterno }} {{ usuarioSeleccionado?.apellidoMaterno }}</p>
        <p><strong>Email:</strong> {{ usuarioSeleccionado?.email }}</p>
        <p><strong>Roles:</strong> {{ usuarioSeleccionado?.roles?.join(', ') }}</p>
      </div>
      <div class="dialog-footer">
        <button class="btn-cancel" (click)="cerrarDialogoDetalles()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Di치logo para agregar usuario -->
  <div class="custom-dialog" *ngIf="mostrarDialogoAgregar">
    <div class="custom-dialog-content">
      <h3>Agregar Usuario</h3>
      <div class="p-fluid">
        <div class="field">
          <label for="rut">RUT</label>
          <input id="rut" [(ngModel)]="nuevoUsuario.rut" type="text" placeholder="Ej: 12345678-9" />
        </div>
        <div class="field">
          <label for="nombre">Nombre</label>
          <input id="nombre" [(ngModel)]="nuevoUsuario.nombre" type="text" />
        </div>
        <div class="field">
          <label for="apellidoPaterno">Apellido Paterno</label>
          <input id="apellidoPaterno" [(ngModel)]="nuevoUsuario.apellidoPaterno" type="text" />
        </div>
        <div class="field">
          <label for="apellidoMaterno">Apellido Materno</label>
          <input id="apellidoMaterno" [(ngModel)]="nuevoUsuario.apellidoMaterno" type="text" />
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" [(ngModel)]="nuevoUsuario.email" type="email" />
        </div>
        <div class="field">
          <label for="roles">Roles</label>
          <input id="roles" [(ngModel)]="nuevoUsuario.roles" type="text" placeholder="Ejemplo: administrador, usuario" />
        </div>
        <div class="dialog-footer">
          <button class="btn-save" (click)="guardarUsuario()">Guardar</button>
          <button class="btn-cancel" (click)="cerrarDialogoAgregar()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</div>
